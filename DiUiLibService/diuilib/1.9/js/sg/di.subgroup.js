
function di_create_subgroup_selection_ui(){var uid=di_sg_indicator_nid+'_'+di_sg_unit_nid;var di_sg_html_data='';var xml_obj='';var sgpanelwidth='';if(di_sg_width.toString().indexOf('%')>0){sgpanelwidth=di_sg_width;}
else{sgpanelwidth=di_sg_width+'px';}
di_sg_html_data+='<div style="width:'+sgpanelwidth+';">';if(di_sg_title!=''){di_sg_html_data+='<div class="di_gui_title">'+di_sg_title+'</div>';}
di_sg_html_data+='<div style="height:'+(di_sg_height-22)+'px;"><table width="100%" cellpadding="0" cellspacing="0" class="" align="left">';di_sg_html_data+='<tr><td id="di_avl_sgd'+uid+'" width="100%" valign="top"><table cellspacing="0" cellpadding="0"><tr><td class="di_gui_link3" style="padding-left:5px;" height="25"><div onclick=\'di_sg_change_mode("list", "", "", "'+di_sg_indicator_nid+'", "'+di_sg_unit_nid+'")\'>'+di_sg_lbl_list+'</div></td>';di_jq.ajax({type:'GET',url:di_sg_codelist_url+'/ius/ius_'+di_sg_indicator_nid+'_'+di_sg_unit_nid+'.xml',dataType:"xml",async:false,success:function(xml){xml_obj=xml;var totalSGD=di_jq(xml).find('st').length;if(totalSGD>0){var colCount=0;di_jq(xml).find('st').each(function(){var sg_dim_name=di_jq(this).attr("n");var sg_dim_nid=di_jq(this).attr("nid");var objectXml=di_jq(this);var totalSGDVals=objectXml.find('stv').length;if(totalSGDVals>0){var check_checkbox='';if(di_handle_undefined(di_store_selected_sg_dim[di_sg_indicator_nid+'_'+di_sg_unit_nid])!=''&&di_check_duplicate(di_store_selected_sg_dim[di_sg_indicator_nid+'_'+di_sg_unit_nid],sg_dim_nid)==1){check_checkbox='checked="checked"'}
di_sg_html_data+='<td style="padding-left:5px;"><table cellpadding="0" cellspacing="0"><tr><td style="padding-left:3px;">|</td><td style="padding-left:3px;"><input type="checkbox" onclick=\'di_sg_change_mode("listdim", this.checked, "'+sg_dim_nid+'", "'+di_sg_indicator_nid+'", "'+di_sg_unit_nid+'")\' value="'+sg_dim_nid+'" '+check_checkbox+'></td><td style="padding-left:5px;" class="di_gui_seld_txt">&nbsp;'+sg_dim_name+'</td></tr></table></td>';if(colCount==4){di_sg_html_data+='</tr><tr>';colCount=0;di_sg_dimention_rowcount=di_sg_dimention_rowcount+1;}
colCount++;}});}}});if(window.ActiveXObject)
{di_sg_divwidth='98%';}
else
{di_sg_divwidth='98%';}
di_sg_html_data+='</tr></table></td></tr>';di_sg_html_data+='<tr><td><div id="di_sg_selected'+uid+'" class="di_gui_smallbox_panel" style="width:'+di_sg_divwidth+';height:'+(di_sg_height-60)+'px;"></div></td></tr>';di_sg_html_data+='</table></div>';if(di_sg_show_buttons==true){di_sg_html_data+='<div class="di_gui_buttonbox"><input type="button" class="di_gui_button" name="di_ok'+uid+'" id="di_ok'+uid+'" value="'+di_sg_lbl_ok+'" onclick="di_click_subgroup_ok_button()"><input type="button" class="di_gui_button" name="di_cancel'+uid+'" id="di_cancel'+uid+'" value="'+di_sg_lbl_close+'" onclick="di_click_subgroup_cancel_button()"></div>';}
di_sg_html_data+='</div>';return di_sg_html_data;}
function di_sg_getlist(action,i_nid,u_nid){if(di_handle_undefined(action)==''){action='list';}
var html_ui='';var iu_nids=i_nid+'_'+u_nid;if(action=='list'){if(di_handle_undefined(di_store_selected_sg_dim[i_nid+'_'+u_nid])!='')
di_store_selected_sg_dim[i_nid+'_'+u_nid]=[];di_jq('#di_sg_selected'+iu_nids).empty();di_jq('#di_avl_sgd'+iu_nids+' input:checkbox:checked').each(function(e){di_jq(this).attr('checked',false);});di_jq.ajax({type:'GET',url:di_sg_codelist_url+'/ius/ius_'+iu_nids+'.xml',dataType:"xml",async:false,success:function(xml){var defiusnid=di_jq(xml).find('iu[inid="'+i_nid+'"]').attr("defiusnid");var totalSV=di_jq(xml).find('ius').length;if(totalSV>0){html_ui+='<div><input type="checkbox" id="sgv_'+iu_nids+'" onclick=\'di_sg_selectall(this.id, "di_sg_selected'+iu_nids+'", "'+i_nid+'", "'+u_nid+'", "sg")\'><label class="di_gui_lists_specialoption"> '+di_ind_lbl_select_all+'</label></div>';di_jq(xml).find('ius').each(function(){var sv_name=di_jq(this).attr("n");var sv_nid=di_jq(this).attr("nid");var sg_is_global=di_jq(this).attr('sisG');var iusnid=di_jq(this).attr("iusnid");var dataexists=di_jq(this).attr("dataexists");var check_checkbox='';if(di_handle_undefined(di_store_selected_iusnid[i_nid+'_'+u_nid])!=''&&di_check_duplicate(di_store_selected_iusnid[i_nid+'_'+u_nid],iusnid)==1){check_checkbox='checked="checked"';}
else if(iusnid==defiusnid&&di_jq("#iu_"+iu_nids+' > input:checkbox').is(':checked')){check_checkbox='checked="checked"';di_store_checked_iusnids(true,iusnid+'||'+sv_name,i_nid,u_nid);}
html_ui+='<div id="sv_'+iusnid+'"><input id="sgvchk_'+iusnid+'" rel="'+sv_nid+'" class="sgv_'+iu_nids+'" type="checkbox" value="'+iusnid+'" '+check_checkbox+' onclick=\'di_store_checked_iusnids(this.checked, "'+iusnid+'||'+sv_name+'", "'+i_nid+'", "'+u_nid+'")\'><label class="di_gui_tree_label" onmouseover="di_onmouseover_subgroup(\'sv_'+iusnid+'\')" onmouseout="di_onmouseout_subgroup(\'sv_'+iusnid+'\')" onclick=\'di_clicksubgroup("sv_'+iusnid+'", "'+iusnid+'||'+sv_name+'", "'+i_nid+'", "'+u_nid+'")\'> '+sv_name+'</label></div>';});}}});}
else if(action=='listdim'){var selected_dim=new Array();var di_sg_total_arr=new Array();var xml_obj=new Array();di_jq('#di_sg_selected'+iu_nids).empty();di_jq('#di_avl_sgd'+iu_nids+' input:checkbox:checked').each(function(e){selected_dim.push(this.value);});if(selected_dim.length==0){if(i_nid==''||i_nid==null||i_nid==undefined){i_nid=di_sg_indicator_nid;}
if(u_nid==''||u_nid==null||u_nid==undefined){u_nid=di_sg_unit_nid;}
di_sg_change_mode('list','','',i_nid,u_nid);return false;}
di_jq.ajax({type:'GET',url:di_sg_codelist_url+'/ius/ius_'+iu_nids+'.xml',dataType:"xml",async:false,success:function(xml){xml_obj=xml;for(var i=0;i<selected_dim.length;i++){di_jq(xml).find('st[nid='+selected_dim[i]+']').each(function(){var innerobj=di_jq(this);di_jq(innerobj).find('stv').each(function(){di_sg_total_arr.push(di_jq(this).attr('n'));});});}}});var selectionDimCount=selected_dim.length;if(di_jq(xml_obj).find('ius').length>0){html_ui='<div><input type="checkbox" id="sgv_'+iu_nids+'" onclick=\'di_sg_selectall(this.id, "di_sg_selected'+iu_nids+'", "'+i_nid+'", "'+u_nid+'", "sg")\'><label class="di_gui_lists_specialoption"> '+di_ind_lbl_select_all+'</label></div>';di_jq(xml_obj).find('ius').each(function(){var sg_name=di_jq(this).attr('n');var sv_nid=di_jq(this).attr("nid");var iusnid=di_jq(this).attr('iusnid');var sg_is_global=di_jq(this).attr('sisG');var sg_data_exist=di_jq(this).attr('dataexists');var count=0;for(var j=0;j<di_sg_total_arr.length;j++){sg_name=sg_name.replace(/^\s+|\s+$/g,"");var di_replaced=sg_name.search(di_sg_total_arr[j])>=0;if(di_replaced){sg_name=sg_name.replace(di_sg_total_arr[j]," ");count=count+1;}
if(sg_name==" "){if(count>=selectionDimCount){var check_checkbox='';if(di_handle_undefined(di_store_selected_iusnid[i_nid+'_'+u_nid])!=''&&di_check_duplicate(di_store_selected_iusnid[i_nid+'_'+u_nid],iusnid)==1){check_checkbox='checked="checked"'}
else{}
html_ui+='<div id="sv_'+iusnid+'"><input id="sgvchk_'+iusnid+'" rel="'+sv_nid+'" class="sgv_'+iu_nids+'" type="checkbox" value="'+iusnid+'" '+check_checkbox+' onclick=\'di_store_checked_iusnids(this.checked, "'+iusnid+'||'+di_jq(this).attr('n')+'", "'+i_nid+'", "'+u_nid+'")\'><label class="di_gui_tree_label" onmouseover="di_onmouseover_subgroup(\'sv_'+iusnid+'\')" onmouseout="di_onmouseout_subgroup(\'sv_'+iusnid+'\')" onclick=\'di_clicksubgroup("sv_'+iusnid+'", "'+iusnid+'||'+di_jq(this).attr('n')+'", "'+i_nid+'", "'+u_nid+'")\'> '+di_jq(this).attr('n')+'</label></div>';count=0;}}}});}}
di_jq("#di_sg_selected"+iu_nids).append(html_ui);}
function di_sg_change_mode(mode,chk_status,chk_val,i_nid,u_nid){if(di_handle_undefined(mode)==''){mode='listdim';}
if(mode=='listdim'&&di_handle_undefined(chk_val)!=''){di_store_checked_dimensions(chk_status,chk_val,i_nid,u_nid);}
di_sg_getlist(mode,i_nid,u_nid);}
function di_clicksubgroup(subgroupid,val,i_nid,u_nid){if(di_jq('#'+subgroupid+' > input:checkbox:not(:checked)').length==0){di_jq('#'+subgroupid+' > input').attr('checked',false);di_store_checked_iusnids(false,val,i_nid,u_nid);}
else{di_jq('#'+subgroupid+' > input').attr('checked',true);di_store_checked_iusnids(true,val,i_nid,u_nid);}}
function di_onmouseover_subgroup(subgroupid){di_jq('#'+subgroupid+' > label').addClass('di_gui_label_hover');}
function di_onmouseout_subgroup(subgroupid){di_jq('#'+subgroupid+' > label').removeClass('di_gui_label_hover');}
function di_sg_selectall(level_id,parent_nid,i_nid,u_nid,wherepressed){try
{var searchTag="iusnid_";if(wherepressed=='sg'){searchTag="sv_";}
var obj_id=di_jq("#"+level_id).is(':checked');if(obj_id){di_jq("#iu_"+i_nid+'_'+u_nid+' input:checkbox[value='+i_nid+'~'+u_nid+']').attr('checked','checked');di_ind_store_checked_indicators(true,i_nid+'~'+u_nid);di_jq("."+level_id).attr('checked','checked');di_jq('#'+parent_nid+' input:checkbox:checked').each(function(){if(this.id!=''&&this.id!='ind_'+i_nid+'_'+u_nid&&this.id!='sgv_'+i_nid+'_'+u_nid){var iusnid_valtext=this.value+'||'+di_jq('#'+searchTag+this.value+' >label').text();di_store_checked_iusnids(true,iusnid_valtext,i_nid,u_nid);}});}
else{di_jq("."+level_id).attr('checked','');di_jq('#'+parent_nid+' input:checkbox:not(:checked)').each(function(){if(this.id!=''&&this.id!='ind_'+i_nid+'_'+u_nid&&this.id!='sgv_'+i_nid+'_'+u_nid){var iusnid_valtext=this.value+'||'+di_jq('#'+searchTag+this.value+' >label').text();di_store_checked_iusnids(false,iusnid_valtext,i_nid,u_nid);}});}}
catch(err){}}
function di_store_checked_iusnids(checkbox_status,checkbox_value,i_nid,u_nid){try
{checkbox_value_brk=checkbox_value.split("||");iusnid_val=checkbox_value_brk[0];iusnid_text=checkbox_value_brk[1];var iu_nid=i_nid+'_'+u_nid;var temp_store=[];var temp_store_txt=[];if(checkbox_status==true){di_jq("#iu_"+i_nid+'_'+u_nid+' input:checkbox[value='+i_nid+'~'+u_nid+']').attr('checked','checked');di_ind_store_checked_indicators(true,i_nid+'~'+u_nid);if(di_handle_undefined(di_store_selected_iusnid[iu_nid])!=''){var di_idx=di_check_duplicate(di_store_selected_iusnid[iu_nid],iusnid_val);if(di_idx==-1){temp_store=di_store_selected_iusnid[iu_nid];temp_store.push(iusnid_val);di_store_selected_iusnid[iu_nid]=temp_store;temp_store_txt=di_store_selected_iusnid_txt[iu_nid];temp_store_txt.push(checkbox_value);di_store_selected_iusnid_txt[iu_nid]=temp_store_txt;}}
else{temp_store.push(iusnid_val);di_store_selected_iusnid[iu_nid]=[];di_store_selected_iusnid[iu_nid]=temp_store;temp_store_txt.push(checkbox_value);di_store_selected_iusnid_txt[iu_nid]=[];di_store_selected_iusnid_txt[iu_nid]=temp_store_txt;}
di_jq('#svchk_'+iusnid_val).attr('checked',true);}
else if(checkbox_status==false){var idx;if(di_handle_undefined(di_store_selected_iusnid[iu_nid])!=''){temp_store=di_store_selected_iusnid[iu_nid];for(var i=0;i<temp_store.length;i++){if(temp_store[i]==iusnid_val){temp_store.splice(i,1);break;}}
di_store_selected_iusnid[iu_nid]=temp_store;temp_store_txt=di_store_selected_iusnid_txt[iu_nid];for(var i=0;i<temp_store_txt.length;i++){if(temp_store_txt[i]==checkbox_value){temp_store_txt.splice(i,1);break;}
else{if(temp_store_txt[i].indexOf(iusnid_val+'||')>-1){temp_store_txt.splice(i,1);break;}}}
di_store_selected_iusnid_txt[iu_nid]=temp_store_txt;}
di_jq('#svchk_'+iusnid_val).attr('checked',false);di_checksgforiu(i_nid,u_nid);}
di_sg_get_count();}
catch(err){}}
function di_checksgforiu(i_nid,u_nid){if(di_jq('#ind_'+i_nid+'_'+u_nid).length){var totSgCount=di_jq('#iu_'+i_nid+'_'+u_nid+' ul input:checkbox:checked[id!="ind_'+i_nid+'_'+u_nid+'"]').length;}
else{var totSgCount=di_jq('#di_sg_selected'+i_nid+'_'+u_nid+' input:checkbox:checked[id!="sgv_'+i_nid+'_'+u_nid+'"]').length;}
if(totSgCount==0){di_jq("#iu_"+i_nid+'_'+u_nid+' input:checkbox[value='+i_nid+'~'+u_nid+']').attr('checked',false);di_ind_store_checked_indicators(false,i_nid+'~'+u_nid);}}
function di_store_checked_dimensions(checkbox_status,checkbox_value,i_nid,u_nid){try
{var iu_nid=i_nid+'_'+u_nid;var temp_store=[];if(checkbox_status==true){if(di_handle_undefined(di_store_selected_sg_dim[iu_nid])!=''){var di_idx=di_check_duplicate(di_store_selected_sg_dim[iu_nid],checkbox_value);if(di_idx==-1){temp_store=di_store_selected_sg_dim[iu_nid];temp_store.push(checkbox_value);di_store_selected_sg_dim[iu_nid]=temp_store;}}
else{temp_store.push(checkbox_value);di_store_selected_sg_dim[iu_nid]=[];di_store_selected_sg_dim[iu_nid]=temp_store;}}
else if(checkbox_status==false){var idx;if(di_handle_undefined(di_store_selected_sg_dim[iu_nid])!=''){temp_store=di_store_selected_sg_dim[iu_nid];for(var i=0;i<temp_store.length;i++){if(temp_store[i]==checkbox_value){temp_store.splice(i,1);break;}}
di_store_selected_sg_dim[iu_nid]=temp_store;}}}
catch(err){}}
function di_sg_get_count(){var count=0;for(var i=0;i<di_store_selected_indicators.length;i++){var IUArray=di_store_selected_indicators[i].split("~");var i_nid=IUArray[0];var u_nid=IUArray[1];if(di_handle_undefined(di_store_selected_iusnid_txt[i_nid+'_'+u_nid])!=''){count=count+di_store_selected_iusnid_txt[i_nid+'_'+u_nid].length;}}
di_jq('#di_iusnid_count_sel').html(count);}
function di_sg_view_selections(){di_jq('#di_sg_mosvsl').html('');for(var i=0;i<di_store_selected_indicators.length;i++){var IUArray=di_store_selected_indicators[i].split("~");var i_nid=IUArray[0];var u_nid=IUArray[1];if(di_handle_undefined(di_store_selected_iusnid_txt[i_nid+'_'+u_nid])!=''){for(var j=0;j<di_store_selected_iusnid_txt[i_nid+'_'+u_nid].length;j++){var iusnidVTx=di_store_selected_iusnid_txt[i_nid+'_'+u_nid][j].split("||");var iusnid=iusnidVTx[0];var sgtxt=iusnidVTx[1];var di_render_ui='<img src="'+di_images_path+'/icon_cross.gif" onclick=\'di_sg_remove_selection("'+iusnid+'||'+sgtxt+'", "'+i_nid+'", "'+u_nid+'")\' class="di_gui_cursor_pointer"> &nbsp;'+sgtxt;di_jq('#di_sg_mosvsl').append('<div id="sgviewsel_'+iusnid+'" style="padding-top:5px;">'+di_render_ui+'</div>');}}}
di_jq('#di_sg_selected_list').show("slide",{direction:"right"},500);}
function di_sg_clear_bttn(){var uid=di_sg_indicator_nid+'_'+di_sg_unit_nid;di_jq('#di_sg_mosvsl').html('');di_jq('#di_sg_selected'+uid+' input:checkbox:checked').attr('checked','');di_jq('#di_ind_tabs-1 input:checkbox:checked').each(function(e){var checkBocId=this.id;if(checkBocId.indexOf("svchk_")>-1){di_jq('#'+this.id).attr('checked',false);}});di_jq('#di_sg_selected_list').hide('slide',{direction:'right'});di_store_selected_iusnid=[];di_store_selected_iusnid_txt=[];di_store_selected_sg_dim=[];di_sg_get_count();}
function di_sg_close_bttn(){di_jq('#di_sg_selected_list').hide('slide',{direction:'right'});}
function di_sg_remove_selection(iusVal,i_nid,u_nid){var iusValBr=iusVal.split("||");var iusnid=iusValBr[0];di_jq("#sgviewsel_"+iusnid).remove();di_jq('#sgvchk_'+iusnid).attr('checked',false);di_jq('#svchk_'+iusnid).attr('checked',false);di_store_checked_iusnids(false,iusVal,i_nid,u_nid);}
function di_get_selected_subgroups(){var uid=di_sg_indicator_nid+'_'+di_sg_unit_nid;var selected_subgroup='';di_jq('#di_sg_selected'+uid+' input:checkbox:checked').each(function(i){if(this.value!=''){selected_subgroup=selected_subgroup+this.value+',';}});return selected_subgroup;}
function di_click_subgroup_ok_button(){alert(di_get_selected_subgroups());}
function di_click_subgroup_cancel_button(){var uid=di_sg_indicator_nid+'_'+di_sg_unit_nid;di_jq('#di_sg_selected'+uid+' input:checkbox:checked').each(function(i){di_jq(this).attr('checked',false);});}